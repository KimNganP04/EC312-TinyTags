<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒêƒÉng B√†i - Tiny Tags</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="marketing.css">
    
    <!-- Additional CSS specific for publish post page -->
    <style>
        /* Custom styles */
        :root {
            --primary-red: #F3376D;
            --primary-dark: #90324D;
            --primary-beige: #FAEED6;
            --primary-yellow: #FADE98;
            --primary-pink-light: #FCE4E5;
            --primary-pink: #FF95A6;
        }
        
        .editor-container {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }
        
        .post-preview {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #e5e7eb;
        }
        
        .platform-schedule-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #e5e7eb;
            margin-bottom: 16px;
            transition: all 0.3s;
        }
        
        .platform-schedule-card:hover {
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
        }
        
        .schedule-time-input {
            border: 1px solid #d1d5db;
            border-radius: 8px;
            padding: 8px 12px;
            width: 100%;
            font-family: 'Inter', sans-serif;
        }
        
        .btn-primary-custom {
            background-color: var(--primary-red);
            color: white;
            padding: 10px 24px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
        }
        
        .btn-primary-custom:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .btn-secondary-custom {
            background-color: white;
            color: var(--primary-dark);
            padding: 10px 24px;
            border-radius: 8px;
            font-weight: 600;
            border: 2px solid var(--primary-dark);
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .btn-secondary-custom:hover {
            background-color: var(--primary-dark);
            color: white;
        }
        
        .btn-success-custom {
            background-color: #10B981;
            color: white;
            padding: 10px 24px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
        }
        
        .btn-success-custom:hover {
            background-color: #059669;
            transform: translateY(-2px);
        }
        
        .publish-option-card {
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 24px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .publish-option-card:hover {
            border-color: var(--primary-red);
            transform: translateY(-3px);
        }
        
        .publish-option-card.selected {
            border-color: var(--primary-red);
            background-color: #FCE4E5;
        }
        
        .platform-tag {
            display: inline-block;
            padding: 8px 16px;
            background: #f3f4f6;
            border-radius: 20px;
            margin: 4px;
            font-size: 14px;
            border: 2px solid transparent;
        }
        
        .platform-tag.active {
            background: var(--primary-red) !important;
            color: white !important;
            border-color: var(--primary-red);
        }
        
        .schedule-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .image-preview {
            max-width: 200px;
            border-radius: 8px;
            margin: 8px;
            object-fit: cover;
        }
        
        .post-meta-info {
            background: #f0f9ff;
            border-left: 4px solid #0369a1;
            padding: 16px;
            border-radius: 8px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 32px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        .success-animation {
            animation: successPulse 2s ease-in-out;
        }
        
        @keyframes successPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Main Container -->
    <div class="min-h-screen flex" style="width: 100%;">
        
        <!-- Sidebar Container (will be loaded by JS) -->
        <div id="sidebar-container">
            <!-- Sidebar will be loaded here -->
        </div>
        
        <div class="main-content">
            <!-- MAIN CONTENT -->
            <div class="flex-1">
                <!-- Header -->
                <header class="bg-white border-b px-8 py-4">
                    <div class="flex justify-between items-center">
                        <div>
                            <h2 class="text-2xl font-bold text-dark" id="page-title">ƒêƒÉng B√†i Vi·∫øt</h2>
                            <p class="text-gray-600" id="page-subtitle">ID: <span id="post-id-display">ƒêang t·∫£i...</span></p>
                        </div>
                        
                        <div class="flex items-center space-x-4">
                            <!-- User info -->
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-gradient-to-r from-red-500 to-pink-500 rounded-full flex items-center justify-center text-white font-bold">
                                    MS
                                </div>
                                <div>
                                    <p class="text-sm font-medium">Marketing Staff</p>
                                    <p class="text-xs text-gray-500">Nh√¢n vi√™n ƒëƒÉng b√†i</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </header>
                
                <!-- Main Content -->
                <main class="p-8">
                    <!-- Action Buttons -->
                    <div class="flex justify-between items-center mb-8">
                        <div class="flex space-x-3">
                            <button onclick="goBack()" class="btn-secondary-custom">
                                <i class="fas fa-arrow-left mr-2"></i>Quay l·∫°i danh s√°ch
                            </button>
                        </div>
                        
                        <div class="text-sm text-gray-600">
                            <i class="fas fa-info-circle mr-2"></i>
                            ƒêang xem tr∆∞·ªõc v√† ƒëƒÉng b√†i vi·∫øt
                        </div>
                    </div>
                    
                    <!-- Post Preview Section -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <!-- Left Column: Post Preview -->
                        <div class="lg:col-span-2">
                            <div class="editor-container mb-6">
                                <div class="p-6">
                                    <h3 class="text-lg font-bold text-dark mb-4">
                                        <i class="fas fa-eye mr-2"></i>Xem tr∆∞·ªõc b√†i vi·∫øt
                                    </h3>
                                    
                                    <!-- Post Preview -->
                                    <div class="post-preview">
                                        <div class="mb-6">
                                            <h4 class="text-2xl font-bold text-dark" id="preview-title">Ti√™u ƒë·ªÅ b√†i vi·∫øt</h4>
                                            <div class="flex items-center mt-2 text-sm text-gray-500">
                                                <span id="preview-category" class="bg-gray-100 px-3 py-1 rounded-full">Danh m·ª•c</span>
                                                <span class="mx-2">‚Ä¢</span>
                                                <span id="preview-date">Ng√†y ƒëƒÉng</span>
                                            </div>
                                        </div>
                                        
                                        <!-- Images Preview -->
                                        <div id="preview-images" class="mb-6 grid grid-cols-2 gap-4">
                                            <!-- Images will be loaded here -->
                                        </div>
                                        
                                        <!-- Content Preview -->
                                        <div class="prose max-w-none">
                                            <div id="preview-content" class="text-gray-700">
                                                N·ªôi dung b√†i vi·∫øt s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y...
                                            </div>
                                        </div>
                                        
                                        <!-- Hashtags Preview -->
                                        <div class="mt-6 pt-6 border-t">
                                            <div id="preview-hashtags" class="flex flex-wrap gap-2">
                                                <!-- Hashtags will be loaded here -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Post Meta Information -->
                            <div class="editor-container">
                                <div class="p-6">
                                    <h3 class="text-lg font-bold text-dark mb-4">
                                        <i class="fas fa-info-circle mr-2"></i>Th√¥ng tin b√†i vi·∫øt
                                    </h3>
                                    
                                    <div class="post-meta-info">
                                        <div class="grid grid-cols-2 gap-4">
                                            <div>
                                                <p class="text-sm text-gray-600">Ng∆∞·ªùi vi·∫øt:</p>
                                                <p class="font-medium" id="post-author">Marketing Staff</p>
                                            </div>
                                            <div>
                                                <p class="text-sm text-gray-600">Ng√†y vi·∫øt:</p>
                                                <p class="font-medium" id="post-write-date">ƒêang t·∫£i...</p>
                                            </div>
                                            <div>
                                                <p class="text-sm text-gray-600">Ng√†y duy·ªát:</p>
                                                <p class="font-medium" id="post-approve-date">ƒêang t·∫£i...</p>
                                            </div>
                                            <div>
                                                <p class="text-sm text-gray-600">Ng∆∞·ªùi duy·ªát:</p>
                                                <p class="font-medium" id="post-approver">Qu·∫£n l√Ω</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Right Column: Publish Options -->
                        <div>
                            <div class="editor-container sticky top-8">
                                <div class="p-6">
                                    <h3 class="text-lg font-bold text-dark mb-6">
                                        <i class="fas fa-paper-plane mr-2"></i>T√πy ch·ªçn ƒëƒÉng b√†i
                                    </h3>
                                    
                                    <!-- Publish Now Option -->
                                    <div class="publish-option-card mb-4" onclick="selectPublishOption('now')" id="publish-now-card">
                                        <div class="text-4xl mb-4 text-green-600">
                                            <i class="fas fa-bolt"></i>
                                        </div>
                                        <h4 class="text-xl font-bold mb-2">ƒêƒÉng ngay</h4>
                                        <p class="text-gray-600 text-sm mb-4">B√†i vi·∫øt s·∫Ω ƒë∆∞·ª£c ƒëƒÉng l√™n c√°c n·ªÅn t·∫£ng ƒë√£ ch·ªçn ngay l·∫≠p t·ª©c</p>
                                        <div class="text-xs text-green-600 bg-green-100 px-3 py-1 rounded-full inline-block">
                                            <i class="fas fa-clock mr-1"></i>Ngay l·∫≠p t·ª©c
                                        </div>
                                    </div>
                                    
                                    <!-- Schedule Option -->
                                    <div class="publish-option-card" onclick="selectPublishOption('schedule')" id="publish-schedule-card">
                                        <div class="text-4xl mb-4 text-blue-600">
                                            <i class="fas fa-calendar-alt"></i>
                                        </div>
                                        <h4 class="text-xl font-bold mb-2">L√™n l·ªãch ƒëƒÉng</h4>
                                        <p class="text-gray-600 text-sm mb-4">Ch·ªçn th·ªùi ƒëi·ªÉm c·ª• th·ªÉ ƒë·ªÉ b√†i vi·∫øt t·ª± ƒë·ªông ƒëƒÉng l√™n</p>
                                        <div class="text-xs text-blue-600 bg-blue-100 px-3 py-1 rounded-full inline-block">
                                            <i class="fas fa-calendar mr-1"></i>Theo l·ªãch tr√¨nh
                                        </div>
                                    </div>
                                    
                                    <!-- Selected Platforms -->
                                    <div class="mt-8">
                                        <h4 class="text-lg font-bold text-dark mb-4">
                                            <i class="fas fa-share-alt mr-2"></i>N·ªÅn t·∫£ng ƒëƒÉng b√†i
                                        </h4>
                                        <div id="selected-platforms-display" class="mb-4">
                                            <!-- Platforms will be loaded here -->
                                        </div>
                                    </div>
                                    
                                    <!-- Schedule Section (Hidden by default) -->
                                    <div id="schedule-section" class="schedule-section hidden">
                                        <h4 class="text-lg font-bold text-dark mb-4">
                                            <i class="fas fa-clock mr-2"></i>L·ªãch tr√¨nh ƒëƒÉng b√†i
                                        </h4>
                                        
                                        <div id="platform-schedule-cards">
                                            <!-- Schedule cards for each platform will be added here -->
                                        </div>
                                        
                                        <div class="mt-4 text-sm text-gray-500">
                                            <i class="fas fa-info-circle mr-1"></i>
                                            Th·ªùi gian s·∫Ω ƒë∆∞·ª£c chuy·ªÉn ƒë·ªïi t·ª± ƒë·ªông theo m√∫i gi·ªù Vi·ªát Nam (GMT+7)
                                        </div>
                                    </div>
                                    
                                    <!-- Action Buttons -->
                                    <div class="mt-8 space-y-3">
                                        <button id="publish-now-btn" class="btn-success-custom w-full hidden" onclick="publishNow()">
                                            <i class="fas fa-bolt mr-2"></i>ƒêƒÉng ngay
                                        </button>
                                        
                                        <button id="schedule-btn" class="btn-primary-custom w-full hidden" onclick="schedulePost()">
                                            <i class="fas fa-calendar-check mr-2"></i>L√™n l·ªãch ƒëƒÉng
                                        </button>
                                        
                                        <div id="publish-status" class="text-center text-sm hidden">
                                            <!-- Status messages will appear here -->
                                        </div>
                                    </div>
                                    
                                    <!-- Quick Tips -->
                                    <div class="mt-8 p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                                        <h5 class="font-bold text-yellow-800 mb-2">
                                            <i class="fas fa-lightbulb mr-2"></i>M·∫πo ƒëƒÉng b√†i
                                        </h5>
                                        <ul class="text-sm text-yellow-700 space-y-1">
                                            <li>‚Ä¢ ƒêƒÉng v√†o khung gi·ªù 7-9h s√°ng ho·∫∑c 7-9h t·ªëi ƒë·ªÉ ƒë·∫°t t∆∞∆°ng t√°c cao nh·∫•t</li>
                                            <li>‚Ä¢ Facebook Groups th∆∞·ªùng ho·∫°t ƒë·ªông m·∫°nh v√†o bu·ªïi t·ªëi</li>
                                            <li>‚Ä¢ TikTok c√≥ l∆∞·ª£t xem cao nh·∫•t v√†o gi·ªù ngh·ªâ tr∆∞a v√† t·ªëi</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="success-modal" class="modal">
        <div class="modal-content">
            <div class="text-center">
                <div class="text-6xl text-green-500 mb-4 success-animation">
                    <i class="fas fa-check-circle"></i>
                </div>
                <h3 class="text-2xl font-bold text-gray-800 mb-2" id="success-title">Th√†nh c√¥ng!</h3>
                <p class="text-gray-600 mb-6" id="success-message">B√†i vi·∫øt ƒë√£ ƒë∆∞·ª£c ƒëƒÉng th√†nh c√¥ng!</p>
                <div class="flex space-x-3 justify-center">
                    <button onclick="closeSuccessModal()" class="btn-primary-custom px-6">
                        <i class="fas fa-check mr-2"></i>OK
                    </button>
                    <button onclick="goToList()" class="btn-secondary-custom px-6">
                        <i class="fas fa-list mr-2"></i>V·ªÅ danh s√°ch
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Files -->
    <script src="marketing.js"></script>
    
    <!-- JavaScript for Publish Post Page -->
    <script>
        // Global variables
        let currentPostId = null;
        let postData = null;
        let selectedPlatforms = [];
        let publishOption = null;
        let scheduleData = {};
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Get post ID from URL
            const urlParams = new URLSearchParams(window.location.search);
            currentPostId = urlParams.get('id');
            
            if (!currentPostId) {
                alert('Kh√¥ng t√¨m th·∫•y b√†i vi·∫øt!');
                window.location.href = 'danhsachbaiviet.html';
                return;
            }
            
            // Load post data
            loadPostData(currentPostId);
            
            // Setup event listeners
            setupEventListeners();
        });
        
        // Load post data
        function loadPostData(postId) {
            const post = getPostById(postId);
            
            if (!post) {
                alert('B√†i vi·∫øt kh√¥ng t·ªìn t·∫°i!');
                window.location.href = 'danhsachbaiviet.html';
                return;
            }
            
            // Check if post is approved
            if (post.status !== 'approved') {
                alert('B√†i vi·∫øt ch∆∞a ƒë∆∞·ª£c duy·ªát ho·∫∑c kh√¥ng ·ªü tr·∫°ng th√°i c√≥ th·ªÉ ƒëƒÉng!');
                window.location.href = 'danhsachbaiviet.html';
                return;
            }
            
            postData = post;
            
            // Update UI with post data
            updateUIWithPostData(post);
            
            console.log('‚úÖ ƒê√£ load b√†i vi·∫øt th√†nh c√¥ng:', post);
        }
        
        // Update UI with post data
        function updateUIWithPostData(post) {
            console.log('üîÑ ƒêang load d·ªØ li·ªáu b√†i vi·∫øt:', {
                id: post.id,
                title: post.title,
                hashtags: post.hashtags,
                images: post.images,
                platforms: post.platforms
            });
            
            // Basic info
            document.getElementById('post-id-display').textContent = post.id;
            document.getElementById('page-title').textContent = `ƒêƒÉng b√†i: ${post.title || 'B√†i vi·∫øt kh√¥ng c√≥ ti√™u ƒë·ªÅ'}`;
            
            // Post preview
            document.getElementById('preview-title').textContent = post.title || 'Kh√¥ng c√≥ ti√™u ƒë·ªÅ';
            
            // Category
            const categoryMap = {
                'moc-khoa': 'M√≥c kh√≥a charm',
                'day-deo': 'D√¢y ƒëeo ƒëi·ªán tho·∫°i charm',
                'set-diy': 'Set DIY charm',
                'vong-tay': 'V√≤ng tay charm'
            };
            const categoryName = categoryMap[post.category] || 'Kh√¥ng x√°c ƒë·ªãnh';
            document.getElementById('preview-category').textContent = categoryName;
            
            // Dates
            const today = new Date().toLocaleDateString('vi-VN');
            document.getElementById('preview-date').textContent = today;
            
            if (post.writeDate) {
                document.getElementById('post-write-date').textContent = formatDate(post.writeDate);
            }
            
            if (post.approvedAt) {
                document.getElementById('post-approve-date').textContent = formatDate(post.approvedAt);
            }
            
            // Content
            if (post.content) {
                document.getElementById('preview-content').innerHTML = post.content;
            } else if (post.description) {
                document.getElementById('preview-content').innerHTML = `<p>${post.description}</p>`;
            }
            
            // Images
            const imagesContainer = document.getElementById('preview-images');
            imagesContainer.innerHTML = '';
            
            if (post.images && Array.isArray(post.images) && post.images.length > 0) {
                post.images.forEach((img, index) => {
                    if (index < 4) { // Show max 4 images
                        const imgElement = document.createElement('img');
                        imgElement.src = img.url || img;
                        imgElement.alt = `H√¨nh ${index + 1}`;
                        imgElement.className = 'image-preview w-full h-48 object-cover rounded-lg';
                        imagesContainer.appendChild(imgElement);
                    }
                });
            } else {
                imagesContainer.innerHTML = '<p class="text-gray-500 italic">Kh√¥ng c√≥ h√¨nh ·∫£nh</p>';
            }
            
            // Hashtags
            const hashtagsContainer = document.getElementById('preview-hashtags');
            hashtagsContainer.innerHTML = '';
            
            if (post.hashtags && Array.isArray(post.hashtags) && post.hashtags.length > 0) {
                post.hashtags.forEach(tag => {
                    const tagElement = document.createElement('span');
                    tagElement.className = 'bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm';
                    tagElement.textContent = `#${tag}`;
                    hashtagsContainer.appendChild(tagElement);
                });
            } else {
                hashtagsContainer.innerHTML = '<span class="text-gray-500 italic">Kh√¥ng c√≥ hashtag</span>';
            }
            
            // Platforms
            selectedPlatforms = [];
            if (post.platforms && Array.isArray(post.platforms)) {
                // Filter out generic 'facebook' and ensure we have specific platforms
                post.platforms.forEach(platform => {
                    if (platform === 'facebook') {
                        if (!selectedPlatforms.includes('facebook_page')) {
                            selectedPlatforms.push('facebook_page');
                        }
                        if (!selectedPlatforms.includes('facebook_group')) {
                            selectedPlatforms.push('facebook_group');
                        }
                    } else if (platform !== 'facebook_page' && platform !== 'facebook_group') {
                        selectedPlatforms.push(platform);
                    }
                });
                
                // Ensure we don't have duplicates
                selectedPlatforms = [...new Set(selectedPlatforms)];
            } else {
                // Default platforms
                selectedPlatforms = ['facebook_page', 'facebook_group', 'tiktok'];
            }
            
            updatePlatformsDisplay();
            generateScheduleCards();
            
            console.log('‚úÖ ƒê√£ load xong:', { 
                selectedPlatforms 
            });
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Auto-select publish now option
            selectPublishOption('now');
            
            // Setup date/time inputs for tomorrow by default
            setupDefaultScheduleTimes();
        }
        
        // Update platforms display
        function updatePlatformsDisplay() {
            const container = document.getElementById('selected-platforms-display');
            container.innerHTML = '';
            
            const platformNames = {
                'facebook_page': { name: 'Trang Facebook', icon: 'fab fa-facebook', color: 'bg-blue-100 text-blue-800' },
                'facebook_group': { name: 'Nh√≥m Facebook', icon: 'fas fa-users', color: 'bg-blue-50 text-blue-700' },
                'tiktok': { name: 'TikTok', icon: 'fab fa-tiktok', color: 'bg-gray-100 text-gray-800' }
            };
            
            selectedPlatforms.forEach(platform => {
                const platformInfo = platformNames[platform] || { name: platform, icon: 'fas fa-globe', color: 'bg-gray-100 text-gray-800' };
                
                const platformElement = document.createElement('div');
                platformElement.className = 'platform-tag mb-2';
                platformElement.innerHTML = `
                    <i class="${platformInfo.icon} mr-2"></i>
                    ${platformInfo.name}
                `;
                container.appendChild(platformElement);
            });
            
            if (selectedPlatforms.length === 0) {
                container.innerHTML = '<p class="text-gray-500 italic">Ch∆∞a ch·ªçn n·ªÅn t·∫£ng n√†o</p>';
            }
        }
        
        // Select publish option
        function selectPublishOption(option) {
            publishOption = option;
            
            // Update UI
            const publishNowCard = document.getElementById('publish-now-card');
            const scheduleCard = document.getElementById('publish-schedule-card');
            const scheduleSection = document.getElementById('schedule-section');
            const publishNowBtn = document.getElementById('publish-now-btn');
            const scheduleBtn = document.getElementById('schedule-btn');
            
            if (option === 'now') {
                publishNowCard.classList.add('selected');
                scheduleCard.classList.remove('selected');
                scheduleSection.classList.add('hidden');
                publishNowBtn.classList.remove('hidden');
                scheduleBtn.classList.add('hidden');
            } else {
                publishNowCard.classList.remove('selected');
                scheduleCard.classList.add('selected');
                scheduleSection.classList.remove('hidden');
                publishNowBtn.classList.add('hidden');
                scheduleBtn.classList.remove('hidden');
            }
        }
        
        // Generate schedule cards for each platform
        function generateScheduleCards() {
            const container = document.getElementById('platform-schedule-cards');
            container.innerHTML = '';
            
            const platformNames = {
                'facebook_page': { name: 'Trang Facebook', icon: 'fab fa-facebook' },
                'facebook_group': { name: 'Nh√≥m Facebook', icon: 'fas fa-users' },
                'tiktok': { name: 'TikTok', icon: 'fab fa-tiktok' }
            };
            
            selectedPlatforms.forEach(platform => {
                const platformInfo = platformNames[platform] || { name: platform, icon: 'fas fa-globe' };
                
                const card = document.createElement('div');
                card.className = 'platform-schedule-card';
                card.innerHTML = `
                    <div class="flex items-center mb-4">
                        <div class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center mr-3">
                            <i class="${platformInfo.icon} text-lg"></i>
                        </div>
                        <div>
                            <h5 class="font-bold">${platformInfo.name}</h5>
                            <p class="text-sm text-gray-600">Ch·ªçn th·ªùi gian ƒëƒÉng</p>
                        </div>
                    </div>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Ng√†y ƒëƒÉng</label>
                            <input type="date" 
                                   id="schedule-date-${platform}" 
                                   class="schedule-time-input"
                                   min="${getTomorrowDate()}">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Gi·ªù ƒëƒÉng</label>
                            <input type="time" 
                                   id="schedule-time-${platform}" 
                                   class="schedule-time-input"
                                   value="19:00">
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }
        
        // Setup default schedule times (tomorrow at 7 PM)
        function setupDefaultScheduleTimes() {
            const tomorrow = getTomorrowDate();
            const defaultTime = '19:00';
            
            selectedPlatforms.forEach(platform => {
                const dateInput = document.getElementById(`schedule-date-${platform}`);
                const timeInput = document.getElementById(`schedule-time-${platform}`);
                
                if (dateInput) dateInput.value = tomorrow;
                if (timeInput) timeInput.value = defaultTime;
            });
        }
        
        // Get tomorrow's date in YYYY-MM-DD format
        function getTomorrowDate() {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            return tomorrow.toISOString().split('T')[0];
        }
        
        // Format date
        function formatDate(dateString) {
            if (!dateString) return '';
            try {
                const date = new Date(dateString);
                if (isNaN(date.getTime())) {
                    return dateString;
                }
                return date.toLocaleDateString('vi-VN', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            } catch (e) {
                return dateString;
            }
        }
        
        // Publish now function
        function publishNow() {
            if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën ƒëƒÉng b√†i vi·∫øt n√†y ngay b√¢y gi·ªù?')) {
                return;
            }
            
            // Update status in UI
            const statusDiv = document.getElementById('publish-status');
            statusDiv.classList.remove('hidden');
            statusDiv.innerHTML = '<div class="text-blue-600"><i class="fas fa-spinner fa-spin mr-2"></i>ƒêang ƒëƒÉng b√†i...</div>';
            
            // Simulate publishing delay
            setTimeout(() => {
                // Update post status to published
                updatePostStatus('published');
                
                // Show success message
                statusDiv.innerHTML = '<div class="text-green-600"><i class="fas fa-check-circle mr-2"></i>ƒêƒÉng b√†i th√†nh c√¥ng!</div>';
                
                // Show success modal
                showSuccessModal('B√†i vi·∫øt ƒë√£ ƒë∆∞·ª£c ƒëƒÉng th√†nh c√¥ng!', 'ƒêƒÉng ngay th√†nh c√¥ng');
                
                // Update button state
                const publishNowBtn = document.getElementById('publish-now-btn');
                publishNowBtn.disabled = true;
                publishNowBtn.innerHTML = '<i class="fas fa-check mr-2"></i>ƒê√£ ƒëƒÉng';
                publishNowBtn.classList.remove('btn-success-custom');
                publishNowBtn.classList.add('bg-gray-300', 'text-gray-500', 'cursor-not-allowed');
                
            }, 2000);
        }
        
        // Schedule post function
        function schedulePost() {
            // Collect schedule data
            scheduleData = {};
            let hasError = false;
            
            selectedPlatforms.forEach(platform => {
                const dateInput = document.getElementById(`schedule-date-${platform}`);
                const timeInput = document.getElementById(`schedule-time-${platform}`);
                
                if (!dateInput || !timeInput) {
                    hasError = true;
                    return;
                }
                
                const date = dateInput.value;
                const time = timeInput.value;
                
                if (!date || !time) {
                    hasError = true;
                    alert(`Vui l√≤ng ch·ªçn th·ªùi gian ƒëƒÉng cho ${platform}`);
                    return;
                }
                
                scheduleData[platform] = {
                    date: date,
                    time: time,
                    datetime: new Date(`${date}T${time}`).toISOString()
                };
            });
            
            if (hasError) {
                return;
            }
            
            if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën l√™n l·ªãch ƒëƒÉng b√†i vi·∫øt n√†y?')) {
                return;
            }
            
            // Update status in UI
            const statusDiv = document.getElementById('publish-status');
            statusDiv.classList.remove('hidden');
            statusDiv.innerHTML = '<div class="text-blue-600"><i class="fas fa-spinner fa-spin mr-2"></i>ƒêang l√™n l·ªãch ƒëƒÉng...</div>';
            
            // Simulate scheduling delay
            setTimeout(() => {
                // Update post status to scheduled
                updatePostStatus('scheduled');
                
                // Save schedule data to post
                saveScheduleData();
                
                // Show success message
                statusDiv.innerHTML = '<div class="text-green-600"><i class="fas fa-check-circle mr-2"></i>L√™n l·ªãch ƒëƒÉng th√†nh c√¥ng!</div>';
                
                // Show success modal
                showSuccessModal('B√†i vi·∫øt ƒë√£ ƒë∆∞·ª£c l√™n l·ªãch ƒëƒÉng th√†nh c√¥ng!', 'L√™n l·ªãch th√†nh c√¥ng');
                
                // Update button state
                const scheduleBtn = document.getElementById('schedule-btn');
                scheduleBtn.disabled = true;
                scheduleBtn.innerHTML = '<i class="fas fa-calendar-check mr-2"></i>ƒê√£ l√™n l·ªãch';
                scheduleBtn.classList.remove('btn-primary-custom');
                scheduleBtn.classList.add('bg-gray-300', 'text-gray-500', 'cursor-not-allowed');
                
            }, 2000);
        }
        
        // Update post status in storage
        function updatePostStatus(newStatus) {
            if (!postData) return;
            
            // Update post data
            postData.status = newStatus;
            
            if (newStatus === 'published') {
                postData.publishDate = new Date().toISOString();
                postData.publishedAt = new Date().toISOString();
                postData.publishedBy = 'Staff';
            } else if (newStatus === 'scheduled') {
                postData.scheduledAt = new Date().toISOString();
                postData.scheduledBy = 'Staff';
            }
            
            // Update in localStorage
            updatePostInStorage(postData);
            
            console.log(`‚úÖ ƒê√£ c·∫≠p nh·∫≠t tr·∫°ng th√°i b√†i vi·∫øt th√†nh: ${newStatus}`);
        }
        
        // Save schedule data to post
        function saveScheduleData() {
            if (!postData) return;
            
            postData.scheduleData = scheduleData;
            postData.scheduledPlatforms = selectedPlatforms;
            
            // Update in localStorage
            updatePostInStorage(postData);
            
            console.log('‚úÖ ƒê√£ l∆∞u l·ªãch tr√¨nh ƒëƒÉng b√†i:', scheduleData);
        }
        
        // Show success modal
        function showSuccessModal(message, title) {
            document.getElementById('success-title').textContent = title;
            document.getElementById('success-message').textContent = message;
            document.getElementById('success-modal').style.display = 'flex';
        }
        
        // Close success modal
        function closeSuccessModal() {
            document.getElementById('success-modal').style.display = 'none';
        }
        
        // Go back to list
        function goBack() {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën quay l·∫°i danh s√°ch b√†i vi·∫øt?')) {
                window.location.href = 'danhsachbaiviet.html';
            }
        }
        
        // Go to list from success modal
        function goToList() {
            window.location.href = 'danhsachbaiviet.html';
        }
        
        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            if ((event.ctrlKey || event.metaKey) && event.key === 'Enter') {
                event.preventDefault();
                if (publishOption === 'now') {
                    publishNow();
                } else {
                    schedulePost();
                }
            }
        });
    </script>
</body>
</html>