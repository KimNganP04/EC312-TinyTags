<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tiny Tags Admin - Cập nhật sản phẩm</title>
    <!-- LOAD CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/slidebar.css">
    <style>
        .form-page {
            margin-left: 260px;
            padding: 30px;
            min-height: 100vh;
            background: #f8f9fa;
            transition: margin-left 0.3s;
            width: calc(100% - 260px);
            box-sizing: border-box;
        }
        
        @media (max-width: 1200px) {
            .form-page {
                margin-left: 80px;
                width: calc(100% - 80px);
                padding: 20px;
            }
        }
        
        @media (max-width: 768px) {
            .form-page {
                margin-left: 0;
                width: 100%;
                padding: 15px;
                padding-top: 80px;
            }
        }
        
        .page-header {
            margin-bottom: 30px;
        }
        
        .page-header h1 {
            font-size: 28px;
            color: #90324D;
            margin-bottom: 10px;
        }
        
        .back-link {
            color: #666;
            text-decoration: none;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }
        
        .back-link:hover {
            color: #F3376D;
        }
        
        /* Form Container */
        .form-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }
        
        .form-title {
            font-size: 22px;
            color: #333;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #FCE4E5;
        }
        
        .product-info-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #FCE4E5;
        }
        
        .product-id {
            font-size: 14px;
            color: #666;
            background: #f8f9fa;
            padding: 5px 10px;
            border-radius: 6px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            color: #333;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .form-input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #FCE4E5;
            border-radius: 8px;
            font-size: 14px;
            color: #333;
            box-sizing: border-box;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #F3376D;
        }
        
        .form-input::placeholder {
            color: #999;
        }
        
        /* Form Layout */
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Price Section */
        .price-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #eee;
        }
        
        /* Image Upload */
        .image-upload-container {
            border: 2px dashed #FCE4E5;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            background: #fafafa;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .image-upload-container:hover {
            border-color: #F3376D;
            background: #fff9fb;
        }
        
        .upload-icon {
            font-size: 48px;
            color: #F3376D;
            margin-bottom: 15px;
        }
        
        .upload-text {
            color: #333;
            margin-bottom: 10px;
            font-size: 16px;
            font-weight: 500;
        }
        
        .upload-hint {
            color: #666;
            font-size: 14px;
        }
        
        .upload-btn {
            background: #F3376D;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            margin-top: 15px;
            transition: background 0.3s;
        }
        
        .upload-btn:hover {
            background: #e03162;
        }
        
        /* Textarea */
        textarea.form-input {
            min-height: 120px;
            resize: vertical;
            font-family: inherit;
        }
        
        /* Select styling */
        select.form-input {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23F3376D'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 20px;
            padding-right: 40px;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
        }
        
        .form-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #FCE4E5;
        }
        
        .btn-save {
            background: linear-gradient(135deg, #F3376D 0%, #FF6B9D 100%);
            color: white;
            padding: 12px 30px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 15px;
            min-width: 160px;
            justify-content: center;
        }
        
        .btn-save:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(243, 55, 109, 0.3);
        }
        
        .btn-cancel {
            background: white;
            color: #666;
            padding: 12px 30px;
            border-radius: 8px;
            border: 1px solid #FCE4E5;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 15px;
            min-width: 160px;
            justify-content: center;
        }
        
        .btn-cancel:hover {
            background: #f8f9fa;
            color: #333;
        }
        
        
        /* Toast Notification */
        .toast {
            position: fixed;
            top: 30px;
            right: 30px;
            background: white;
            border-radius: 8px;
            padding: 15px 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s;
        }
        
        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .toast.success {
            border-left: 4px solid #00b894;
        }
        
        .toast.error {
            border-left: 4px solid #d63031;
        }
        
        .toast-icon {
            font-size: 20px;
        }
        
        .toast.success .toast-icon {
            color: #00b894;
        }
        
        .toast.error .toast-icon {
            color: #d63031;
        }
        
        .toast-content h4 {
            margin: 0;
            font-size: 14px;
            color: #333;
        }
        
        .toast-content p {
            margin: 5px 0 0;
            font-size: 13px;
            color: #666;
        }
        
        /* Confirmation Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1001;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        
        .modal.show {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
        }
        
        .modal-header {
            margin-bottom: 20px;
        }
        
        .modal-header h3 {
            font-size: 18px;
            color: #333;
            margin: 0;
        }
        
        .modal-body {
            margin-bottom: 25px;
        }
        
        .modal-body p {
            color: #666;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        .btn-modal {
            padding: 10px 20px;
            border-radius: 6px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            font-size: 14px;
        }
        
        .btn-modal.cancel {
            background: white;
            color: #666;
            border: 1px solid #FCE4E5;
        }
        
        .btn-modal.cancel:hover {
            background: #f8f9fa;
        }
        
        .btn-modal.confirm {
            background: #F3376D;
            color: white;
        }
        
        .btn-modal.confirm:hover {
            background: #e03162;
        }
        
        .btn-modal.delete {
            background: #d63031;
            color: white;
        }
        
        .btn-modal.delete:hover {
            background: #c62828;
        }
        
        /* Image Preview */
        .image-preview-container {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-top: 15px;
        }
        
        .current-image {
            max-width: 150px;
            border-radius: 8px;
            border: 2px solid #F3376D;
        }
        
        .image-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        /* Status Indicators */
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-active {
            background: #00b894;
        }
        
        .status-draft {
            background: #fdcb6e;
        }
        
        .status-out {
            background: #d63031;
        }
    </style>
</head>
<body>
    <!-- ===== SIDEBAR ===== -->
    <div class="sidebar" id="sidebar">
        <div class="logo">
            <div class="logo-icon">
                <img src="../assets/images/image1.png" alt="Tiny Tags Logo">
            </div>
            <div class="logo-text">
                <div class="logo-title">Tiny Tags</div>
            </div>
        </div>

        <ul class="nav-menu">
            <li class="nav-item">
                <a href="index.html" class="nav-link">
                    <i class="fas fa-th-large nav-icon"></i>
                    <span class="nav-text">Dashboard</span>
                </a>
            </li>

            <li class="nav-item">
                <a href="products.html" class="nav-link">
                    <i class="fas fa-box nav-icon"></i>
                    <span class="nav-text">Sản phẩm</span>
                </a>
            </li>

            <li class="nav-item">
                <a href="customer.html" class="nav-link">
                    <i class="fas fa-users nav-icon"></i>
                    <span class="nav-text">Khách hàng</span>
                </a>
            </li>

            <li class="nav-item">
                <a href="messages.html" class="nav-link">
                    <i class="fas fa-comment-dots nav-icon"></i>
                    <span class="nav-text">Tin nhắn</span>
                </a>
            </li>

            <li class="nav-item">
                <a href="#" class="nav-link">
                    <i class="fas fa-shopping-cart nav-icon"></i>
                    <span class="nav-text">Đơn đặt hàng</span>
                </a>
            </li>

            <li class="nav-item">
                <a href="#" class="nav-link">
                    <i class="fas fa-receipt nav-icon"></i>
                    <span class="nav-text">Hóa đơn</span>
                </a>
            </li>

            <li class="nav-item">
                <a href="#" class="nav-link">
                    <i class="fas fa-gift nav-icon"></i>
                    <span class="nav-text">Khuyến mãi</span>
                </a>
            </li>

            <li class="nav-item">
                <a href="../index.html" class="nav-link">
                    <i class="fas fa-bullhorn nav-icon"></i>
                    <span class="nav-text">Marketing</span>
                </a>
            </li>

            <li class="nav-item">
                <a href="../pages/sale/index.html" class="nav-link">
                    <i class="fas fa-chart-line nav-icon"></i>
                    <span class="nav-text">Sale</span>
                </a>
            </li>
        </ul>

        <div class="sidebar-footer">
            <a href="../auth/login.html" class="logout-link">
                <i class="fas fa-sign-out-alt nav-icon"></i>
                <span class="nav-text">Đăng xuất</span>
            </a>
        </div>
    </div>

    <!-- Mobile Toggle Button -->
    <div class="mobile-toggle" id="mobileToggle">
        <i class="fas fa-bars"></i>
    </div>

    <!-- ===== MAIN CONTENT ===== -->
    <main class="form-page">
        <!-- Header -->
        <header class="page-header">
            <a href="products.html" class="back-link">
                <i class="fas fa-arrow-left"></i>
                Quay lại danh sách sản phẩm
            </a>
            <h1>Cập nhật sản phẩm</h1>
        </header>

        <!-- Form Container -->
        <div class="form-container">
            <div class="product-info-header">
                <h2 class="form-title">CHỈNH SỬA SẢN PHẨM</h2>
                <span class="product-id" id="productId">ID: TT-CHARM-001</span>
            </div>
            
            <form id="editProductForm">
                <!-- Tên sản phẩm -->
                <div class="form-group">
                    <label class="form-label">Tên sản phẩm *</label>
                    <input type="text" class="form-input" id="productName" value="Charm móc khóa Hồ Ly" required>
                </div>

                <!-- Thông tin cơ bản -->
                <h3 class="form-title" style="font-size: 18px; margin-bottom: 20px;">Thông tin cơ bản</h3>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Loại sản phẩm *</label>
                        <select class="form-input" id="productCategory" required>
                            <option value="">Chọn loại sản phẩm</option>
                            <option value="charm" selected>Charm móc khóa</option>
                            <option value="diy">Sét DIY</option>
                            <option value="strap">Charm dây đeo</option>
                            <option value="keychain">Móc khóa</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">SKU (Mã sản phẩm)</label>
                        <input type="text" class="form-input" id="productSku" value="TT-CHARM-001">
                    </div>
                </div>

                <!-- Số lượng và giá -->
                <div class="price-section">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Số lượng *</label>
                            <input type="number" class="form-input" id="productQuantity" value="45" min="0" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Giá vốn (đ)</label>
                            <input type="number" class="form-input" id="productCost" value="80000" min="0">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Đơn giá bán * (đ)</label>
                            <input type="number" class="form-input" id="productPrice" value="120000" min="0" required>
                        </div>
                    </div>
                </div>

                <!-- Hình ảnh -->
                <div class="form-group">
                    <label class="form-label">Hình ảnh</label>
                    
                    <!-- Current Image -->
                    <div class="image-preview-container">
                        <img src="https://via.placeholder.com/150x150?text=Charm+Hồ+Ly" alt="Charm móc khóa Hồ Ly" class="current-image" id="currentImage">
                        
                        <div class="image-actions">
                            <span style="font-size: 13px; color: #666; margin-bottom: 5px;">Ảnh hiện tại</span>
                            <div style="display: flex; gap: 10px;">
                                <button type="button" class="upload-btn" onclick="document.getElementById('productImage').click()" style="padding: 8px 15px; font-size: 13px;">
                                    <i class="fas fa-sync-alt"></i> Thay ảnh
                                </button>
                                <button type="button" onclick="removeCurrentImage()" style="padding: 8px 15px; font-size: 13px; background: #f8f9fa; border: 1px solid #ddd; border-radius: 6px; cursor: pointer;">
                                    <i class="fas fa-trash"></i> Xóa ảnh
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Upload New Image -->
                    <div class="image-upload-container" id="imageUpload" style="display: none; margin-top: 15px;">
                        <div class="upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <div class="upload-text">Tải ảnh mới lên</div>
                        <div class="upload-hint">Kéo thả hoặc click để chọn file</div>
                        <input 
                            type="file" 
                            id="productImage" 
                            accept="image/*" 
                            style="display: none;"
                        >
                        <button type="button" class="upload-btn" onclick="document.getElementById('productImage').click()">
                            <i class="fas fa-image"></i> Chọn ảnh mới
                        </button>
                    </div>
                    
                    <div id="imagePreview" style="margin-top: 15px; display: none;">
                        <img id="previewImage" src="" alt="Preview" style="max-width: 200px; border-radius: 8px; border: 2px solid #F3376D;">
                        <button type="button" onclick="cancelNewImage()" style="margin-left: 10px; padding: 5px 10px; background: #f8f9fa; border: 1px solid #ddd; border-radius: 4px; cursor: pointer;">
                            <i class="fas fa-times"></i> Hủy
                        </button>
                    </div>
                </div>

                <!-- Mô tả -->
                <div class="form-group">
                    <label class="form-label">Mô tả sản phẩm</label>
                    <textarea class="form-input" id="productDescription" rows="4">Charm móc khóa Hồ Ly thiết kế tinh xảo, phù hợp làm quà tặng hoặc trang trí.</textarea>
                </div>

                <!-- Trạng thái -->
                <div class="form-group">
                    <label class="form-label">Trạng thái *</label>
                    <select class="form-input" id="productStatus" required>
                        <option value="active" selected>
                            <span class="status-indicator status-active"></span> Đang bán
                        </option>
                        <option value="draft">
                            <span class="status-indicator status-draft"></span> Bản nháp
                        </option>
                        <option value="out">
                            <span class="status-indicator status-out"></span> Hết hàng
                        </option>
                    </select>
                </div>

                <!-- Actions -->
                <div class="form-actions">
                    <button type="submit" class="btn-save">
                        <i class="fas fa-save"></i>
                        Lưu thay đổi
                    </button>
                    <button type="button" class="btn-cancel" id="cancelBtn">
                        <i class="fas fa-times"></i>
                        Hủy bỏ
                    </button>
                </div>
            </form>
        </div>
    </main>

    <!-- Toast Notification -->
    <div class="toast" id="successToast">
        <div class="toast-icon">
            <i class="fas fa-check-circle"></i>
        </div>
        <div class="toast-content">
            <h4>Thành công!</h4>
            <p id="toastMessage">Thay đổi đã được lưu thành công.</p>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Xác nhận</h3>
            </div>
            <div class="modal-body">
                <p id="modalMessage">Bạn có chắc chắn muốn hủy chỉnh sửa sản phẩm? Thay đổi chưa lưu sẽ bị mất.</p>
            </div>
            <div class="modal-actions">
                <button class="btn-modal cancel" id="modalCancelBtn">Hủy bỏ</button>
                <button class="btn-modal confirm" id="modalConfirmBtn">Xác nhận</button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal" id="deleteModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Xác nhận xóa</h3>
            </div>
            <div class="modal-body">
                <p>Bạn có chắc chắn muốn xóa sản phẩm <strong id="productNameToDelete">Charm móc khóa Hồ Ly</strong>? Hành động này không thể hoàn tác.</p>
            </div>
            <div class="modal-actions">
                <button class="btn-modal cancel" id="deleteModalCancelBtn">Hủy bỏ</button>
                <button class="btn-modal delete" id="deleteModalConfirmBtn">Xóa sản phẩm</button>
            </div>
        </div>
    </div>

    <!-- ===== JAVASCRIPT ===== -->
    <script src="../js/common.js"></script>
    <script>
        // Sample product data (in real app, this would come from API)
        const productData = {
            id: "TT-CHARM-001",
            name: "Charm móc khóa Hồ Ly",
            category: "charm",
            sku: "TT-CHARM-001",
            quantity: 45,
            cost: 80000,
            price: 120000,
            description: "Charm móc khóa Hồ Ly thiết kế tinh xảo, phù hợp làm quà tặng hoặc trang trí.",
            status: "active",
            image: "https://via.placeholder.com/150x150?text=Charm+Hồ+Ly",
            createdAt: "2024-01-15",
            updatedAt: "2024-03-20",
            soldCount: 128
        };

        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('editProductForm');
            const cancelBtn = document.getElementById('cancelBtn');
            const deleteBtn = document.getElementById('deleteBtn');
            const successToast = document.getElementById('successToast');
            const confirmModal = document.getElementById('confirmModal');
            const deleteModal = document.getElementById('deleteModal');
            const modalCancelBtn = document.getElementById('modalCancelBtn');
            const modalConfirmBtn = document.getElementById('modalConfirmBtn');
            const deleteModalCancelBtn = document.getElementById('deleteModalCancelBtn');
            const deleteModalConfirmBtn = document.getElementById('deleteModalConfirmBtn');
            
            // Set product ID
            document.getElementById('productId').textContent = `ID: ${productData.id}`;
            document.getElementById('productNameToDelete').textContent = productData.name;
            
            // Image elements
            const currentImage = document.getElementById('currentImage');
            const imageUpload = document.getElementById('imageUpload');
            const productImage = document.getElementById('productImage');
            const imagePreview = document.getElementById('imagePreview');
            const previewImage = document.getElementById('previewImage');
            
            let newImageFile = null;
            let imageChanged = false;

            // Click to upload new image
            imageUpload.addEventListener('click', function() {
                productImage.click();
            });

            // File input change
            productImage.addEventListener('change', function(e) {
                if (this.files.length > 0) {
                    handleImageFile(this.files[0]);
                }
            });

            function handleImageFile(file) {
                if (!file.type.startsWith('image/')) {
                    showToast('Vui lòng chọn file hình ảnh!', 'error');
                    return;
                }

                if (file.size > 5 * 1024 * 1024) { // 5MB limit
                    showToast('Kích thước file quá lớn. Vui lòng chọn ảnh dưới 5MB.', 'error');
                    return;
                }

                newImageFile = file;
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImage.src = e.target.result;
                    imagePreview.style.display = 'block';
                    imageUpload.style.display = 'none';
                    imageChanged = true;
                };
                reader.readAsDataURL(file);
            }

            // Remove current image
            window.removeCurrentImage = function() {
                currentImage.style.display = 'none';
                imageUpload.style.display = 'block';
                imageChanged = true;
            };

            // Cancel new image
            window.cancelNewImage = function() {
                imagePreview.style.display = 'none';
                imageUpload.style.display = 'none';
                currentImage.style.display = 'block';
                productImage.value = '';
                previewImage.src = '';
                newImageFile = null;
                imageChanged = false;
            };

            // Form submission
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Get form values
                const name = document.getElementById('productName').value.trim();
                const category = document.getElementById('productCategory').value;
                const quantity = parseInt(document.getElementById('productQuantity').value) || 0;
                const price = parseInt(document.getElementById('productPrice').value) || 0;
                
                // Validate required fields
                if (!name) {
                    showToast('Vui lòng nhập tên sản phẩm', 'error');
                    document.getElementById('productName').focus();
                    return;
                }
                
                if (!category) {
                    showToast('Vui lòng chọn loại sản phẩm', 'error');
                    document.getElementById('productCategory').focus();
                    return;
                }
                
                if (quantity < 0) {
                    showToast('Số lượng không hợp lệ', 'error');
                    document.getElementById('productQuantity').focus();
                    return;
                }
                
                if (price <= 0) {
                    showToast('Vui lòng nhập giá bán hợp lệ', 'error');
                    document.getElementById('productPrice').focus();
                    return;
                }
                
                // Prepare updated data
                const updatedData = {
                    ...productData,
                    name: name,
                    category: category,
                    sku: document.getElementById('productSku').value.trim(),
                    quantity: quantity,
                    cost: parseInt(document.getElementById('productCost').value) || 0,
                    price: price,
                    description: document.getElementById('productDescription').value.trim(),
                    status: document.getElementById('productStatus').value,
                    updatedAt: new Date().toISOString().split('T')[0]
                };
                
                // Handle image update
                if (imageChanged) {
                    if (newImageFile) {
                        updatedData.image = `data:image/jpeg;base64,...`; // In real app, upload to server
                    } else if (!currentImage.style.display || currentImage.style.display === 'none') {
                        updatedData.image = null;
                    }
                }
                
                console.log('Updated product data:', updatedData);
                
                // Show loading
                const saveBtn = form.querySelector('.btn-save');
                const originalText = saveBtn.innerHTML;
                saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Đang lưu...';
                saveBtn.disabled = true;
                
                // Simulate API call
                setTimeout(() => {
                    // Update product data
                    Object.assign(productData, updatedData);
                    
                    // Show success message
                    document.getElementById('toastMessage').textContent = 'Thay đổi đã được lưu thành công.';
                    showToast('Thay đổi đã được lưu thành công!', 'success');
                    
                    // Reset button
                    saveBtn.innerHTML = originalText;
                    saveBtn.disabled = false;
                    
                    // Reset image change flag
                    imageChanged = false;
                }, 1500);
            });
            
            // Cancel button click
            cancelBtn.addEventListener('click', function() {
                document.getElementById('modalTitle').textContent = 'Xác nhận hủy';
                document.getElementById('modalMessage').textContent = 'Bạn có chắc chắn muốn hủy chỉnh sửa sản phẩm? Thay đổi chưa lưu sẽ bị mất.';
                confirmModal.classList.add('show');
            });
            
            // Delete button click
            deleteBtn.addEventListener('click', function() {
                deleteModal.classList.add('show');
            });
            
            // Cancel modal buttons
            modalCancelBtn.addEventListener('click', function() {
                confirmModal.classList.remove('show');
            });
            
            deleteModalCancelBtn.addEventListener('click', function() {
                deleteModal.classList.remove('show');
            });
            
            // Confirm cancel modal
            modalConfirmBtn.addEventListener('click', function() {
                // Redirect back to products page
                window.location.href = 'products.html';
            });
            
            // Confirm delete modal
            deleteModalConfirmBtn.addEventListener('click', function() {
                // Show loading
                deleteModalConfirmBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Đang xóa...';
                deleteModalConfirmBtn.disabled = true;
                
                // Simulate API call
                setTimeout(() => {
                    console.log('Deleting product:', productData.id);
                    
                    // Show success message
                    showToast('Sản phẩm đã được xóa thành công!', 'success');
                    
                    // Close modal
                    deleteModal.classList.remove('show');
                    
                    // Redirect back to products page after 1.5 seconds
                    setTimeout(() => {
                        window.location.href = 'products.html';
                    }, 1500);
                }, 1500);
            });
            
            // Close modals when clicking outside
            [confirmModal, deleteModal].forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        modal.classList.remove('show');
                    }
                });
            });
            
            // Function to show toast notification
            function showToast(message, type = 'success') {
                // Update toast content
                const toastContent = successToast.querySelector('.toast-content');
                const toastTitle = toastContent.querySelector('h4');
                const toastMessage = toastContent.querySelector('p');
                
                if (type === 'success') {
                    successToast.classList.remove('error');
                    successToast.classList.add('success');
                    toastTitle.textContent = 'Thành công!';
                    toastMessage.textContent = message;
                    
                    // Change icon for success
                    const icon = successToast.querySelector('.toast-icon i');
                    icon.className = 'fas fa-check-circle';
                } else {
                    successToast.classList.remove('success');
                    successToast.classList.add('error');
                    toastTitle.textContent = 'Lỗi!';
                    toastMessage.textContent = message;
                    
                    // Change icon for error
                    const icon = successToast.querySelector('.toast-icon i');
                    icon.className = 'fas fa-exclamation-circle';
                }
                
                // Show toast
                successToast.classList.add('show');
                
                // Hide toast after 3 seconds
                setTimeout(() => {
                    successToast.classList.remove('show');
                }, 3000);
            }
            
            // Auto-generate SKU when name or category changes
            const productNameInput = document.getElementById('productName');
            const productCategorySelect = document.getElementById('productCategory');
            const productSkuInput = document.getElementById('productSku');
            
            function generateSKU() {
                const name = productNameInput.value.trim().toLowerCase();
                const category = productCategorySelect.value;
                
                if (name && category && !productSkuInput.value) {
                    const nameCode = name.replace(/\s+/g, '-').substring(0, 10);
                    const categoryCode = category.substring(0, 3).toUpperCase();
                    const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
                    
                    productSkuInput.value = `TT-${categoryCode}-${nameCode.toUpperCase()}-${random}`;
                }
            }
            
            productNameInput.addEventListener('blur', generateSKU);
            productCategorySelect.addEventListener('change', generateSKU);
            
            // Warn user before leaving page if there are unsaved changes
            let formChanged = false;
            
            const formInputs = form.querySelectorAll('input, textarea, select');
            formInputs.forEach(input => {
                input.addEventListener('input', function() {
                    formChanged = true;
                });
            });
            
            window.addEventListener('beforeunload', function(e) {
                if (formChanged || imageChanged) {
                    e.preventDefault();
                    e.returnValue = '';
                }
            });
        });
    </script>
</body>

</html>
